<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deeh | My Profile</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .hexagon { clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%); }
        body { background-color: #f5f2ed; font-family: 'Poppins', sans-serif; }
    </style>
</head>
<body class="max-w-md mx-auto min-h-screen shadow-xl bg-white">

    <div class="h-32 bg-orange-800 w-full"></div>
    
    <div class="px-6 -mt-16 flex flex-col items-center">
        <div class="hexagon w-32 h-32 bg-stone-300 border-4 border-white overflow-hidden">
            <img id="user-img" src="https://via.placeholder.com/150" class="object-cover w-full h-full">
        </div>
        
        <h2 id="display-name" class="text-2xl font-bold mt-4 text-stone-800">Loading...</h2>
        <p id="display-username" class="text-stone-500">@username</p>
        
        <div class="w-full mt-4">
            <div class="flex justify-between text-[10px] font-bold uppercase mb-1">
                <span>Vibe Score</span>
                <span id="vibe-value">0 / 1000</span>
            </div>
            <div class="w-full bg-stone-200 h-2 rounded-full">
                <div id="vibe-bar" class="bg-orange-600 h-full rounded-full transition-all duration-1000" style="width: 0%"></div>
            </div>
        </div>
    </div>

    <div id="posts-container" class="grid grid-cols-3 gap-1 mt-8 p-1">
        </div>

    <script>
        async function loadProfile() {
            const token = localStorage.getItem('token');
            if (!token) {
                alert("Pehle Login karo bhai!");
                window.location.href = "login.html"; // Redirect to login
                return;
            }

            try {
                // Backend API Call (Replace with your Render/Railway URL)
                const res = await fetch('http://localhost:5000/api/auth/me', {
                    headers: { 'x-auth-token': token }
                });
                const data = await res.json();

                // Update UI with real data
                document.getElementById('display-name').innerText = data.user.username;
                document.getElementById('display-username').innerText = `@${data.user.username}_deeh`;
                document.getElementById('vibe-value').innerText = `${data.user.vibeScore} / 1000`;
                document.getElementById('vibe-bar').style.width = (data.user.vibeScore / 10) + "%";

                // Load User Posts
                const postsGrid = document.getElementById('posts-container');
                data.posts.forEach(post => {
                    const img = document.createElement('img');
                    img.src = post.imageUrl;
                    img.className = "aspect-square object-cover rounded-sm";
                    postsGrid.appendChild(img);
                });

            } catch (err) {
                console.error("Mitti ud gayi profile load karne mein!", err);
            }
        }
        loadProfile();
    </script>
</body>
</html>
