<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deeh | Live Social App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #f3f4f6; }
        .app-container { max-width: 450px; margin: 0 auto; background: white; min-height: 100vh; position: relative; box-shadow: 0 0 50px rgba(0,0,0,0.1); }
        .hidden { display: none !important; }
        .active-tab { color: #3b82f6; border-bottom: 3px solid #3b82f6; font-weight: 700; }
        .toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: #1e293b; color: white; padding: 12px 24px; border-radius: 50px; font-size: 14px; z-index: 1000; animation: slideUp 0.3s ease; }
        @keyframes slideUp { from { bottom: -50px; opacity: 0; } to { bottom: 20px; opacity: 1; } }
        .preview-image { width: 100%; max-height: 200px; object-fit: cover; border-radius: 15px; margin-top: 10px; }
    </style>
</head>
<body>

<div class="app-container pb-24">
    <!-- Toast Notification -->
    <div id="toast" class="toast hidden"></div>

    <!-- AUTH PAGE -->
    <div id="authPage" class="px-8 py-20 text-center min-h-screen flex flex-col justify-center bg-gradient-to-r from-blue-500 to-purple-600">
        <div class="bg-white/10 backdrop-blur-lg rounded-3xl p-8 shadow-2xl">
            <h1 class="text-5xl font-extrabold text-white mb-2">Deeh</h1>
            <p class="text-white/80 mb-10">‡§Ö‡§™‡§®‡•Ä real ‡§¶‡•Å‡§®‡§ø‡§Ø‡§æ ‡§∏‡•á ‡§ú‡•Å‡§°‡§º‡•á‡§Ç</p>
            
            <form id="signupForm" class="space-y-4">
                <input type="text" id="regName" placeholder="‡§Ü‡§™‡§ï‡§æ ‡§®‡§æ‡§Æ" required class="w-full p-4 bg-white/20 text-white placeholder-white/70 rounded-2xl outline-none focus:ring-2 focus:ring-white">
                <input type="email" id="regEmail" placeholder="‡§à‡§Æ‡•á‡§≤" required class="w-full p-4 bg-white/20 text-white placeholder-white/70 rounded-2xl outline-none focus:ring-2 focus:ring-white">
                <input type="password" id="regPassword" placeholder="‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°" required class="w-full p-4 bg-white/20 text-white placeholder-white/70 rounded-2xl outline-none focus:ring-2 focus:ring-white">
                <button type="submit" class="w-full py-4 bg-white text-blue-600 font-bold rounded-2xl text-lg shadow-xl hover:bg-blue-50">
                    Join Now üöÄ
                </button>
            </form>
            
            <p class="text-white/60 text-xs mt-6">‡§™‡§π‡§≤‡•á ‡§∏‡•á ‡§Ö‡§ï‡§æ‡§â‡§Ç‡§ü ‡§π‡•à? <span class="text-white font-bold cursor-pointer hover:underline" onclick="showLoginForm()">‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç</span></p>
        </div>
    </div>

    <!-- LOGIN PAGE -->
    <div id="loginPage" class="px-8 py-20 text-center min-h-screen flex flex-col justify-center bg-gradient-to-r from-blue-500 to-purple-600 hidden">
        <div class="bg-white/10 backdrop-blur-lg rounded-3xl p-8 shadow-2xl">
            <h1 class="text-5xl font-extrabold text-white mb-10">Welcome Back! üëã</h1>
            
            <form id="loginForm" class="space-y-4">
                <input type="email" id="loginEmail" placeholder="‡§à‡§Æ‡•á‡§≤" required class="w-full p-4 bg-white/20 text-white placeholder-white/70 rounded-2xl outline-none focus:ring-2 focus:ring-white">
                <input type="password" id="loginPassword" placeholder="‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°" required class="w-full p-4 bg-white/20 text-white placeholder-white/70 rounded-2xl outline-none focus:ring-2 focus:ring-white">
                <button type="submit" class="w-full py-4 bg-white text-blue-600 font-bold rounded-2xl text-lg shadow-xl hover:bg-blue-50">
                    Login üîê
                </button>
            </form>
            
            <p class="text-white/60 text-xs mt-6">‡§®‡§è ‡§π‡•à‡§Ç? <span class="text-white font-bold cursor-pointer hover:underline" onclick="showSignupForm()">‡§∏‡§æ‡§á‡§® ‡§Ö‡§™ ‡§ï‡§∞‡•á‡§Ç</span></p>
        </div>
    </div>

    <!-- MAIN APP -->
    <div id="mainApp" class="hidden">
        <!-- Header -->
        <div class="bg-gradient-to-r from-blue-600 to-purple-600 px-6 py-4 text-white">
            <div class="flex justify-between items-center">
                <h1 class="text-2xl font-extrabold">Dee</h1>
                <div class="flex items-center space-x-4">
                    <span class="text-sm bg-green-400 text-green-900 px-3 py-1 rounded-full">‚óè Online</span>
                    <button onclick="logout()" class="text-sm bg-white/20 px-4 py-2 rounded-xl hover:bg-white/30">Logout</button>
                </div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="flex justify-around bg-white border-b font-bold text-gray-600">
            <button onclick="showSection('feed')" id="feedTab" class="py-3 px-8 active-tab">Circle</button>
            <button onclick="showSection('profile')" id="profileTab" class="py-3 px-8 text-gray-400">Profile</button>
        </div>

        <!-- Feed Section -->
        <div id="feedSection" class="p-4">
            <div id="postsList" class="space-y-4">
                <!-- Posts will load here -->
            </div>
        </div>

        <!-- Profile Section (Exactly like screenshot) -->
        <div id="profileSection" class="hidden p-6">
            <div class="text-center">
                <!-- Profile Avatar -->
                <div class="w-24 h-24 bg-gradient-to-r from-blue-600 to-purple-600 rounded-full flex items-center justify-center text-white text-3xl font-bold mx-auto mb-4">
                    <span id="pInitial">D</span>
                </div>
                
                <!-- Name and Email -->
                <h2 id="pName" class="text-xl font-bold text-gray-800">DEEPAK</h2>
                <p id="pEmail" class="text-gray-500 text-sm mb-6">dipakpal73070@gmail.com</p>
                
                <!-- Total Posts Card -->
                <div class="bg-gray-50 rounded-xl p-6 border border-gray-200">
                    <p class="text-3xl font-bold text-blue-600" id="userPostCount">0</p>
                    <p class="text-sm text-gray-500 mt-1">TOTAL POSTS</p>
                </div>
            </div>
        </div>

        <!-- Post Modal with Image Upload -->
        <div id="postModal" class="fixed inset-0 bg-black/70 z-50 hidden flex items-center justify-center p-4" onclick="if(event.target===this) closeModal()">
            <div class="w-full bg-white rounded-2xl p-6">
                <h3 class="text-xl font-bold text-blue-600 mb-4">‡§®‡§à ‡§™‡•ã‡§∏‡•ç‡§ü ‡§≤‡§ø‡§ñ‡•á‡§Ç üìù</h3>
                
                <textarea id="postText" class="w-full h-32 p-3 bg-gray-50 rounded-xl border border-gray-200 mb-4" placeholder="‡§ï‡•ç‡§Ø‡§æ ‡§ö‡§≤ ‡§∞‡§π‡§æ ‡§π‡•à?"></textarea>
                
                <!-- Image Upload -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">üì∏ ‡§´‡•ã‡§ü‡•ã ‡§°‡§æ‡§≤‡•á‡§Ç</label>
                    <input type="file" id="postImage" accept="image/*" class="w-full p-2 bg-gray-50 rounded-xl border border-gray-200">
                    <div id="imagePreview" class="mt-2 hidden"></div>
                </div>
                
                <div class="flex space-x-2">
                    <button onclick="savePost()" class="flex-1 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-bold rounded-xl">
                        Publish üöÄ
                    </button>
                    <button onclick="closeModal()" class="px-6 py-3 bg-gray-100 text-gray-600 font-bold rounded-xl">
                        Cancel
                    </button>
                </div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <div class="fixed bottom-0 w-full max-w-[450px] bg-white border-t px-12 py-3 flex justify-between items-center">
            <button onclick="showSection('feed')" class="text-2xl" id="navHome">üè†</button>
            <button onclick="openModal()" class="w-14 h-14 bg-gradient-to-r from-blue-600 to-purple-600 rounded-full text-white text-2xl shadow-lg -mt-8">+</button>
            <button onclick="showSection('profile')" class="text-2xl" id="navProfile">üë§</button>
        </div>
    </div>
</div>

<script type="module">
    // üî• FIREBASE IMPORTS
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { 
        getAuth, 
        createUserWithEmailAndPassword, 
        signInWithEmailAndPassword,
        updateProfile, 
        signOut,
        onAuthStateChanged 
    } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
    import { 
        getFirestore, 
        collection, 
        addDoc, 
        query, 
        orderBy, 
        onSnapshot,
        where,
        getDocs,
        serverTimestamp,
        doc,
        updateDoc,
        deleteDoc,
        arrayUnion,
        arrayRemove,
        increment
    } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
    import {
        getStorage,
        ref,
        uploadBytes,
        getDownloadURL
    } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-storage.js";

    // üî• FIREBASE CONFIG - APNA CONFIG YAHAN DALO
    const firebaseConfig = {
        apiKey: "AIzaSyBmwtDM6mget0nZhkGA0D-cUhMrgMd4LQs",
        authDomain: "deeh-e87bf.firebaseapp.com",
        projectId: "deeh-e87bf",
        storageBucket: "deeh-e87bf.firebasestorage.app",
        messagingSenderId: "618337488833",
        appId: "1:618337488833:web:a0a9fdb3df462e6fc1a940"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const storage = getStorage(app);

    let currentUser = null;
    let unsubscribePosts = null;

    // Toast Function
    function showToast(message, type = 'success') {
        const toast = document.getElementById('toast');
        toast.textContent = message;
        toast.style.background = type === 'success' ? '#10b981' : '#ef4444';
        toast.classList.remove('hidden');
        setTimeout(() => toast.classList.add('hidden'), 3000);
    }

    // Global functions
    window.showLoginForm = function() {
        document.getElementById('authPage').classList.add('hidden');
        document.getElementById('loginPage').classList.remove('hidden');
    };

    window.showSignupForm = function() {
        document.getElementById('loginPage').classList.add('hidden');
        document.getElementById('authPage').classList.remove('hidden');
    };

    // Signup
    document.getElementById('signupForm').onsubmit = async (e) => {
        e.preventDefault();
        const name = document.getElementById('regName').value;
        const email = document.getElementById('regEmail').value;
        const password = document.getElementById('regPassword').value;
        
        try {
            const res = await createUserWithEmailAndPassword(auth, email, password);
            await updateProfile(res.user, { displayName: name });
            showToast('Account created! üéâ');
        } catch (err) {
            showToast(err.message, 'error');
        }
    };

    // Login
    document.getElementById('loginForm').onsubmit = async (e) => {
        e.preventDefault();
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;
        
        try {
            await signInWithEmailAndPassword(auth, email, password);
            showToast('Login successful! üéâ');
        } catch (err) {
            showToast(err.message, 'error');
        }
    };

    // Auth State
    onAuthStateChanged(auth, async (user) => {
        if (user) {
            currentUser = user;
            
            document.getElementById('authPage').classList.add('hidden');
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            
            document.getElementById('pName').innerText = (user.displayName || 'User').toUpperCase();
            document.getElementById('pEmail').innerText = user.email;
            document.getElementById('pInitial').innerText = (user.displayName || 'U')[0].toUpperCase();
            
            loadPosts();
            await loadUserPostCount(user.uid);
        } else {
            document.getElementById('mainApp').classList.add('hidden');
            document.getElementById('authPage').classList.remove('hidden');
            if (unsubscribePosts) unsubscribePosts();
        }
    });

    // Load Post Count
    async function loadUserPostCount(uid) {
        const q = query(collection(db, "posts"), where("userId", "==", uid));
        const snapshot = await getDocs(q);
        document.getElementById('userPostCount').textContent = snapshot.size;
    }

    // Image Preview
    document.getElementById('postImage')?.addEventListener('change', function(e) {
        const preview = document.getElementById('imagePreview');
        const file = e.target.files[0];
        
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                preview.innerHTML = `<img src="${e.target.result}" class="preview-image">`;
                preview.classList.remove('hidden');
            };
            reader.readAsDataURL(file);
        } else {
            preview.classList.add('hidden');
            preview.innerHTML = '';
        }
    });

    // Save Post
    window.savePost = async function() {
        const text = document.getElementById('postText').value.trim();
        const imageFile = document.getElementById('postImage').files[0];
        
        if (!text && !imageFile) {
            showToast('‡§ï‡•Å‡§õ ‡§≤‡§ø‡§ñ‡•ã ‡§Ø‡§æ ‡§´‡•ã‡§ü‡•ã ‡§°‡§æ‡§≤‡•ã!', 'error');
            return;
        }

        try {
            let imageUrl = null;
            
            if (imageFile) {
                const storageRef = ref(storage, `posts/${currentUser.uid}/${Date.now()}_${imageFile.name}`);
                const snapshot = await uploadBytes(storageRef, imageFile);
                imageUrl = await getDownloadURL(snapshot.ref);
            }

            await addDoc(collection(db, "posts"), {
                content: text,
                userId: currentUser.uid,
                userName: currentUser.displayName || 'User',
                imageUrl: imageUrl,
                timestamp: serverTimestamp(),
                likes: 0,
                likedBy: [],
                comments: []
            });
            
            document.getElementById('postText').value = '';
            document.getElementById('postImage').value = '';
            document.getElementById('imagePreview').innerHTML = '';
            document.getElementById('imagePreview').classList.add('hidden');
            closeModal();
            
            showToast('‡§™‡•ã‡§∏‡•ç‡§ü ‡§π‡•ã ‡§ó‡§à! üéâ');
            await loadUserPostCount(currentUser.uid);
            
        } catch (err) {
            showToast('Error: ' + err.message, 'error');
        }
    };

    // Load Posts
    function loadPosts() {
        const q = query(collection(db, "posts"), orderBy("timestamp", "desc"));
        
        unsubscribePosts = onSnapshot(q, (snapshot) => {
            const list = document.getElementById('postsList');
            
            if (snapshot.empty) {
                list.innerHTML = '<div class="text-center py-16 text-gray-500">‡§ï‡•ã‡§à ‡§™‡•ã‡§∏‡•ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à</div>';
                return;
            }

            let postsHTML = '';
            snapshot.forEach((doc) => {
                const post = doc.data();
                const postId = doc.id;
                const isLiked = post.likedBy?.includes(currentUser?.uid) || false;
                const time = post.timestamp?.toDate?.() || new Date();
                
                postsHTML += `
                    <div class="bg-white border rounded-xl p-4">
                        <div class="flex items-center space-x-3 mb-2">
                            <div class="w-8 h-8 bg-gradient-to-r from-blue-600 to-purple-600 rounded-full flex items-center justify-center text-white text-sm">
                                ${post.userName?.[0] || 'U'}
                            </div>
                            <div>
                                <p class="font-bold text-sm">${post.userName}</p>
                                <p class="text-xs text-gray-400">${time.toLocaleString()}</p>
                            </div>
                        </div>
                        
                        <p class="text-gray-700 mb-2">${post.content || ''}</p>
                        
                        ${post.imageUrl ? `<img src="${post.imageUrl}" class="w-full rounded-lg mb-2 max-h-60 object-cover">` : ''}
                        
                        <div class="flex items-center space-x-4 pt-2 border-t">
                            <button onclick="likePost('${postId}')" class="flex items-center space-x-1 ${isLiked ? 'text-red-500' : 'text-gray-400'}">
                                <span>‚ù§Ô∏è</span>
                                <span class="text-sm">${post.likes || 0}</span>
                            </button>
                            <button onclick="toggleComments('${postId}')" class="flex items-center space-x-1 text-gray-400">
                                <span>üí¨</span>
                                <span class="text-sm">${post.comments?.length || 0}</span>
                            </button>
                        </div>
                    </div>
                `;
            });
            
            list.innerHTML = postsHTML;
        });
    }

    // Like Post
    window.likePost = async (postId) => {
        const postRef = doc(db, "posts", postId);
        const postSnapshot = await getDocs(query(collection(db, "posts"), where("__name__", "==", postId)));
        const post = postSnapshot.docs[0]?.data();
        
        if (post?.likedBy?.includes(currentUser.uid)) {
            await updateDoc(postRef, { likes: increment(-1), likedBy: arrayRemove(currentUser.uid) });
        } else {
            await updateDoc(postRef, { likes: increment(1), likedBy: arrayUnion(currentUser.uid) });
        }
    };

    window.toggleComments = (postId) => {
        // Comments functionality
    };

    window.logout = () => signOut(auth);

    window.openModal = () => document.getElementById('postModal').classList.remove('hidden');
    window.closeModal = () => document.getElementById('postModal').classList.add('hidden');

    window.showSection = (section) => {
        const feed = document.getElementById('feedSection');
        const profile = document.getElementById('profileSection');
        const feedTab = document.getElementById('feedTab');
        const profileTab = document.getElementById('profileTab');
        
        if (section === 'feed') {
            feed.classList.remove('hidden');
            profile.classList.add('hidden');
            feedTab.classList.add('active-tab');
            profileTab.classList.remove('active-tab');
        } else {
            feed.classList.add('hidden');
            profile.classList.remove('hidden');
            feedTab.classList.remove('active-tab');
            profileTab.classList.add('active-tab');
        }
    };
</script>

</body>
</html>
